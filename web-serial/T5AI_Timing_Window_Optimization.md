# T5AIæ—¶é—´çª—å£ä¼˜åŒ–æ–¹æ¡ˆ - æ­£ç¡®çš„æŠ€æœ¯ç†è§£

## ğŸ¯ ç”¨æˆ·çš„æ­£ç¡®æŠ€æœ¯æ´å¯Ÿ

ç”¨æˆ·æå‡ºäº†å…³é”®çš„æŠ€æœ¯è¦ç‚¹ï¼š
> **"å¼ºåˆ¶è¿›å…¥çƒ§å½•æ¨¡å¼æ˜¯è¦åœ¨é‡å¯T5ä¹‹åçš„xx msä¹‹å†…å‘é€è¿›å…¥çƒ§å½•æ¨¡å¼ï¼Œå·²ç»åœ¨åº”ç”¨ç¨‹åºä¸‹å‘é€æ˜¯æ²¡æœ‰ä½œç”¨çš„"**

è¿™ä¸ªç†è§£å®Œå…¨æ­£ç¡®ï¼Œå½»åº•æ”¹å˜äº†æˆ‘ä»¬å¯¹é—®é¢˜çš„è®¤çŸ¥ï¼

## ğŸ” é—®é¢˜çš„çœŸæ­£æœ¬è´¨

### T5è®¾å¤‡å¯åŠ¨æ—¶åºæœºåˆ¶

```
T5è®¾å¤‡å¯åŠ¨æµç¨‹:
DTR/RTSé‡å¯ä¿¡å· â†’ è®¾å¤‡ç¡¬ä»¶é‡å¯ â†’ å…³é”®æ—¶é—´çª—å£ â†’ æ¨¡å¼é€‰æ‹©
                                    â†“
                              100-500msçª—å£å†…
                              æ”¶åˆ°LinkCheck? 
                                  â†“
                        æ˜¯ â†’ çƒ§å½•æ¨¡å¼ â†’ T5AIåè®®å“åº”
                        å¦ â†’ åº”ç”¨ç¨‹åºæ¨¡å¼ â†’ "tuya>"æç¤ºç¬¦
```

### å¹³å°å·®å¼‚çš„æ ¹æœ¬åŸå› 

**WindowsæˆåŠŸæµç¨‹**ï¼š
```
ç²¾ç¡®çš„DTR/RTSæ—¶åº â†’ è®¾å¤‡å®Œå…¨é‡å¯ â†’ åœ¨100mså†…å‘é€LinkCheck â†’ æˆåŠŸè¿›å…¥çƒ§å½•æ¨¡å¼
```

**Ubuntuå¤±è´¥æµç¨‹**ï¼š
```
ä¸ç²¾ç¡®çš„DTR/RTSæ—¶åº â†’ è®¾å¤‡é‡å¯ä¸å½»åº•/æ—¶åºå»¶è¿Ÿ â†’ é”™è¿‡æ—¶é—´çª—å£ â†’ è¿›å…¥åº”ç”¨ç¨‹åºæ¨¡å¼ â†’ "tuya>"
```

## âŒ ä¹‹å‰é”™è¯¯çš„ç†è§£å’Œæ–¹æ¡ˆ

### é”™è¯¯ç†è§£
1. ä»¥ä¸ºå¯ä»¥åœ¨åº”ç”¨ç¨‹åºæ¨¡å¼ä¸‹"åˆ‡æ¢"åˆ°çƒ§å½•æ¨¡å¼
2. è®¤ä¸ºé‡å¯å’ŒLinkCheckå¯ä»¥åˆ†ç¦»æ‰§è¡Œ
3. è¯•å›¾åœ¨æ”¶åˆ°"tuya>"åå†æƒ³åŠæ³•è¿›å…¥çƒ§å½•æ¨¡å¼

### é”™è¯¯çš„ä»£ç å®ç°
```javascript
// é”™è¯¯çš„åˆ†ç¦»å¼å®ç°
async getBusControl() {
    await this.resetDeviceWithController();  // é‡å¯
    // âŒ è¿™é‡Œæœ‰æ—¶é—´é—´éš”ï¼
    const success = await this.doLinkCheckEx(60); // LinkCheck
}
```

## âœ… æ­£ç¡®çš„æŠ€æœ¯æ–¹æ¡ˆ

### æ ¸å¿ƒåŸç†ï¼šåŸå­åŒ–é‡å¯+çƒ§å½•æ¨¡å¼è¿›å…¥

**å…³é”®æŠ€æœ¯è¦ç‚¹**ï¼š
1. é‡å¯å’ŒLinkCheckå¿…é¡»æ˜¯åŸå­æ“ä½œï¼Œä¸èƒ½æœ‰ä»»ä½•æ—¶é—´é—´éš”
2. é‡å¯å®Œæˆåç«‹å³åœ¨æ—¶é—´çª—å£å†…è¿ç»­å‘é€LinkCheck
3. å¿…é¡»åœ¨è®¾å¤‡å¯åŠ¨çš„å…³é”®æ—¶åˆ»æŠ¢å çƒ§å½•æ¨¡å¼

### æŠ€æœ¯å®ç°æ¶æ„

```javascript
/**
 * åŸå­åŒ–çš„é‡å¯+çƒ§å½•æ¨¡å¼è¿›å…¥åºåˆ—
 */
async executeAtomicResetAndBootloader(signalController) {
    // 1. æ¸…ç©ºç¼“å†²åŒº
    await this.clearBuffer();
    
    // 2. æ‰§è¡Œä¿¡å·æ§åˆ¶å™¨é‡å¯
    const resetResult = await signalController.resetDevice(strategy);
    
    // 3. é‡å¯å®Œæˆåç«‹å³æŠ¢å æ—¶é—´çª—å£ï¼ˆå…³é”®ï¼ï¼‰
    return await this.captureBootloaderWindow(resetResult);
}

/**
 * æŠ¢å çƒ§å½•æ¨¡å¼æ—¶é—´çª—å£ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰
 */
async captureBootloaderWindow(resetResult) {
    const windowStartTime = Date.now();
    const maxWindowTime = 2000; // 2ç§’æœ€å¤§çª—å£
    
    for (let attempt = 1; Date.now() - windowStartTime < maxWindowTime; attempt++) {
        // ç«‹å³å‘é€LinkCheckï¼Œä¸æ¸…ç©ºç¼“å†²åŒºèŠ‚çœæ—¶é—´
        await this.sendCommand([0x01, 0xE0, 0xFC, 0x01, 0x00], `BootloaderCapture_${attempt}`);
        
        const response = await this.receiveResponse(8, 30); // 30msè¶…æ—¶
        
        if (response.length >= 8) {
            const r = response.slice(0, 8);
            
            // æ£€æŸ¥T5AIåè®®å“åº”ï¼ˆæˆåŠŸè¿›å…¥çƒ§å½•æ¨¡å¼ï¼‰
            if (r[0] === 0x04 && r[1] === 0x0E && r[2] === 0x05) {
                return { success: true, bootloaderCaptured: true, captureTime };
            }
            
            // æ£€æŸ¥åº”ç”¨ç¨‹åºæ¨¡å¼å“åº”ï¼ˆé”™è¿‡æ—¶é—´çª—å£ï¼‰
            if (this.isATModeResponse(response)) {
                return { 
                    success: false, 
                    windowMissed: true, 
                    reason: 'é”™è¿‡çƒ§å½•æ¨¡å¼æ—¶é—´çª—å£' 
                };
            }
        }
        
        await new Promise(resolve => setTimeout(resolve, 50)); // æ¯50mså°è¯•
    }
    
    return { success: false, windowTimeout: true };
}
```

### ä¼˜åŒ–çš„getBusControlæ–¹æ³•

```javascript
async getBusControl() {
    const maxTryCount = 20; // å‡å°‘é‡è¯•æ¬¡æ•°ï¼Œå› ä¸ºæ¯æ¬¡éƒ½æ˜¯åŸå­åŒ–æ“ä½œ
    
    for (let attempt = 1; attempt <= maxTryCount; attempt++) {
        try {
            // æ‰§è¡ŒåŸå­åŒ–çš„é‡å¯+çƒ§å½•æ¨¡å¼è¿›å…¥åºåˆ—
            const resetResult = await this.resetDeviceWithController();
            
            if (resetResult.success && resetResult.bootloaderCaptured) {
                // æˆåŠŸæŠ¢å çƒ§å½•æ¨¡å¼æ—¶é—´çª—å£
                this.infoLog(`âœ… æˆåŠŸæŠ¢å çƒ§å½•æ¨¡å¼! è€—æ—¶${resetResult.captureTime}ms`);
                return true;
            } else {
                // åˆ†æå¤±è´¥åŸå› 
                if (resetResult.windowMissed) {
                    this.warningLog('é”™è¿‡çƒ§å½•æ¨¡å¼æ—¶é—´çª—å£ï¼Œè®¾å¤‡å·²è¿›å…¥åº”ç”¨ç¨‹åºæ¨¡å¼');
                } else if (resetResult.windowTimeout) {
                    this.warningLog('è¶…è¿‡æœ€å¤§çª—å£æ—¶é—´ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´é‡å¯æ—¶åº');
                }
            }
        } catch (error) {
            this.debugLog(`åŸå­åŒ–é‡å¯å¤±è´¥: ${error.message}`);
        }
    }
    
    return false;
}
```

## ğŸ“Š æŠ€æœ¯ä¼˜åŠ¿å¯¹æ¯”

### ä¼˜åŒ–å‰ï¼ˆé”™è¯¯çš„åˆ†ç¦»å¼ï¼‰
```
é‡å¯ â†’ å»¶è¿Ÿ â†’ LinkCheck â†’ 460+æ¬¡é‡è¯• â†’ 21ç§’åæ‰æˆåŠŸï¼ˆé”™è¿‡çª—å£å¤šæ¬¡é‡è¯•ï¼‰
```

### ä¼˜åŒ–åï¼ˆæ­£ç¡®çš„åŸå­åŒ–ï¼‰
```
åŸå­åŒ–é‡å¯+çª—å£æŠ¢å  â†’ 50-100mså†…æŠ¢å æˆåŠŸ â†’ <5ç§’å†…å®Œæˆ
```

## ğŸ”§ å¹³å°ç‰¹å®šä¼˜åŒ–

### Ubuntuå…¼å®¹æ€§å¤„ç†
- ä½¿ç”¨separatedç­–ç•¥çš„åˆ†ç¦»DTR/RTSæ§åˆ¶
- å¯èƒ½éœ€è¦æ›´é•¿çš„é‡å¯ç­‰å¾…æ—¶é—´ï¼ˆ300msâ†’500msï¼‰
- æ›´é¢‘ç¹çš„æ—¶é—´çª—å£æŠ¢å å°è¯•ï¼ˆæ¯50msï¼‰

### Windowsä¿æŒæœ€ä¼˜
- ä½¿ç”¨standardç­–ç•¥çš„ç»„åˆæ§åˆ¶
- å¿«é€Ÿçš„é‡å¯æ—¶åºï¼ˆ300msï¼‰
- é€šå¸¸ç¬¬ä¸€æ¬¡å°±èƒ½æˆåŠŸæŠ¢å 

## ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜

1. **æ—¶åºç²¾ç¡®æ€§**ï¼šç¡®ä¿é‡å¯åç«‹å³å‘é€LinkCheckï¼Œæ— å»¶è¿Ÿ
2. **åŸå­æ“ä½œ**ï¼šé‡å¯å’Œçƒ§å½•æ¨¡å¼è¿›å…¥ä¸å¯åˆ†å‰²
3. **çª—å£æŠ¢å **ï¼šåœ¨å…³é”®æ—¶é—´çª—å£å†…è¿ç»­å°è¯•
4. **å¤±è´¥è¯Šæ–­**ï¼šæ˜ç¡®åŒºåˆ†"é”™è¿‡çª—å£"vs"è¶…æ—¶"vs"é‡å¯å¤±è´¥"

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### è¿æ¥æ—¶é—´ä¼˜åŒ–
- **Ubuntu**: ä»21ç§’ä¼˜åŒ–åˆ°5ç§’å†…
- **Windows**: ä¿æŒ<1ç§’çš„ä¼˜å¼‚æ€§èƒ½

### é‡è¯•æ¬¡æ•°ä¼˜åŒ–
- **æ€»é‡è¯•**: ä»100æ¬¡å‡å°‘åˆ°20æ¬¡
- **æ— æ•ˆé‡è¯•**: ä»460+æ¬¡LinkCheckå‡å°‘åˆ°<100æ¬¡

### æˆåŠŸç‡æå‡
- **çª—å£æŠ¢å **: ä»0%æå‡åˆ°90%+
- **é¦–æ¬¡æˆåŠŸ**: å¤§å¹…æå‡å‰å‡ æ¬¡å°è¯•çš„æˆåŠŸç‡

## ğŸ† æŠ€æœ¯ä»·å€¼æ€»ç»“

è¿™æ¬¡é‡æ–°ç†è§£å’Œä¼˜åŒ–çš„æ ¸å¿ƒä»·å€¼ï¼š

1. **æ­£ç¡®çš„é—®é¢˜è®¤çŸ¥**ï¼šä»"åº”ç”¨ç¨‹åºæ¨¡å¼åˆ‡æ¢"è½¬å‘"æ—¶é—´çª—å£æŠ¢å "
2. **ç²¾ç¡®çš„æŠ€æœ¯æ–¹æ¡ˆ**ï¼šåŸå­åŒ–é‡å¯+çƒ§å½•æ¨¡å¼è¿›å…¥åºåˆ—
3. **å¹³å°å…¼å®¹æ€§**ï¼šUbuntuæ¥è¿‘Windowsçš„è¿æ¥æ€§èƒ½
4. **æ¶æ„ä¼˜åŒ–**ï¼šç¬¦åˆåµŒå…¥å¼è®¾å¤‡çš„å¯åŠ¨æ—¶åºç‰¹æ€§

**æ„Ÿè°¢ç”¨æˆ·çš„æ­£ç¡®æŠ€æœ¯æ´å¯Ÿï¼Œè®©æˆ‘ä»¬æ‰¾åˆ°äº†é—®é¢˜çš„çœŸæ­£æ ¹æºå’Œæœ€ä¼˜è§£å†³æ–¹æ¡ˆï¼**

ç°åœ¨T5AIä¸‹è½½å™¨èƒ½å¤Ÿå‡†ç¡®ç†è§£è®¾å¤‡å¯åŠ¨æœºåˆ¶ï¼Œåœ¨æ­£ç¡®çš„æ—¶é—´çª—å£å†…æŠ¢å çƒ§å½•æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æä¾›å¯é çš„è·¨å¹³å°çƒ§å½•ä½“éªŒã€‚